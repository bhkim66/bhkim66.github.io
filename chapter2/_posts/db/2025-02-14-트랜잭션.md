# 트랜잭션이란?

**트랜잭션**

- 데이터베이스에서 하나의 논리적 기능을 수행하기 위한 작업의 단위
    - **쿼리를 묶는 단위**

**커밋**

- 여러 쿼리가 성공적으로 처리되었다고 확정하는 명령어. 트랜잭션 단위로 수행되며 변경된 내용은 영구적으로 저장

**롤백**

- 트랜잭션으로 처리한 하나의 묶음 과정을 일어나기 전으로 돌리는 일(취소)

**트랜잭션 전파**

- 트랜잭션을 수행할 때 커넥션 단위로 수행하기 때문에 커넥션 객체를 넘겨서 수행해야 하는데 이를 넘겨서 수행하지 않고 트랜잭션 관련 메서드의 호출을 하나의 트랜잭션에 묶이도록 하는 것
    - Spring에선 `@Transactional` 어노테이션을 통해 여러 쿼리 관련 코드들을 하나의 트랜잭션으로 처리한다

    ```java
    @Service
    @Transactional(readOnly = true)
    public class TestService() {
    	...
    }
    ```


## ACID

### Atomicity (원자성)

- 트랜잭션과 관련된 일이 모두 수행되었거나 되지 않았거나를 보장하는 특징

### Consistency (일관성)

- `허용된 방식`으로만 데이터를 변경해야 하는 것을 의미

### Isolation (격리성)

- 트랜잭션 수행 시 서로 끼어들지 못하는 것을 의미

### Durability (지속성)

- 성공적으로 수행된 트랜잭션은 **영원히 반영**되어야 하는 것을 의미

### 무결성

- 데이터의 `정확성`, `일관성`, `유효성`을 유지하는 것을 의미한다

## 격리성

데이터베이스의 격리성에 따라서 트랜잭션이 접근할 수 있는 레벨들이 달라진다

트랜잭션이 순차적으로 실행 되면 격리성은 높아지지만 동시성은 너무 낮아져서 성능이 안좋게된다

격리성이 낮으면 동시성이 높아지게 된다

**격리 수준**

- SERIALIZABLE
- REPEATABLE_READ
- READ_COMMITED
- READ_UNCOMMITED

### **격리 수준에 따라 나타나는 현상**

**팬텀리드**

한 트랜잭션 내에서 동일한 쿼리를 2번 이상 보냈을 때 해당 조회 결과가 다른 것을 의미

![image.png](/assets/img/chapter2/database/dababase_3_1.png)

- 다른 행이 추가되는 현상

**반복가능하지 않은 조회**

한 트랜잭션 내의 같은 행에 두 번 이상 조회가 발생했는데, 그 값이 다른 것을 의미한다

![image.png](/assets/img/chapter2/database/dababase_3_2.png)

- 하나의 행 단위로 조회 했을 때 차이가 발생한다. 팬텀 리드는 조회 범위가 좀 더 크다

**더티리드**

하나의 트랜잭션이 다른 트랜잭션의 아직 커밋되지 않은 데이터를 읽는 현상이다

![image.png](/assets/img/chapter2/database/dababase_3_3.png)

![image.png](/assets/img/chapter2/database/dababase_3_4.png)

### SERIALIZABLE

커밋 완료된 데이터에 대해서만 조회할 수 있으며 트랜잭션을 순차적으로 진행시키는 것을 의미한다.

- **여러 트랜잭션이 동시에 같은 행에 접근할 수 없다**
- 제일 강한 경리성을 띈다

### REPEATABLE_READ

커밋 완료된 데이터만 조회할 수 있으며 반복해서 행을 조회하더라도 똑같은 행을 보장하는 단계이다.

- 하나의 트랜잭션이 수정한 행을 다른 트랜잭션이 수정할 수 없도록 막아주지만 새로운 행을 추가하는 것을 막지 않는다
- MySQL8.0 innoDB의 기본값이기도 하다
- 팬텀 리드가 일어날 수 있다

### **READ_COMMITED**

커밋 완료된 데이터에 대해서만 조회할 수 있으며 커밋이 되지 않는 정보는 읽지 못한다

- PostgreSQL, SQL Server, 오라클에서 기본값으로 설정되어 있다
- 팬텀리드, 반복 가능하지 않은 조회가 일어날 수 있다

### READ_UNCOMMITED

가장 낮은 수준의 격리이며 동시성이 제일 높으므로 빠르다. 다른 트랜잭션이 커밋하지 않는 정보를 읽을 수 있다

- 팬텀리드, 반복 가능하지 않은 조회, 더티리드가 일어날 수 있다

이러한 격리 수준들은 명령어로 단계를 조절할 수 있다

출처 - CS 지식의 정석 | 디자인패턴 네트워크 운영체제 데이터베이스 자료구조