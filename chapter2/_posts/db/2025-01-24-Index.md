# 인덱스 (Index)

### 인덱스

- 인덱스는 책으로 비유하자면 `목차` 같은 개념이다
- 인덱스는 추가적인 쓰기 작업과 저장 공간을 활용하여 **데이터베이스의 검색 속도를 향상하기 위한 자료구조**이다
- `Index`를 통해 검색 속도 향상과 조회 성능을 높일 수 있다
- 인덱스를 사용하지 않으면 테이블은 기본적으로 `Table Full Scan`이 수행되어 처리 속도가 떨어진다
- 인덱스는 `UPDATE`와 `DELETE`의 `WHERE`문에서 데이터를 조회하는 성능을 향상된다

### Index 관리

- 인덱스는 데이터베이스에 별도의 저장공간이 필요하다
- 인덱스는 항상 최신의 정렬된 상태로 유지해야 원하는 데이터를 빠르게 탐색할 수 있다
    - 이를 위해 인덱스는 항상 최신의 정렬 상태를 유지한다
- 인덱스에 적용된 컬럼에 `INSERT`, `UPDATE`, `DELETE`가 수행된다면, 인덱스 관리를 위한 추가적인 연산이 발생하여 그에 따른 *오버헤드*가 발생한다
    - `DELETE`, `UPDATE`시 기존의 인덱스를 삭제하지 않고 `사용하지 않음` 처리를 하기 때문에 인덱스 크기가 커져, 처리 성능이 떨어진다

### B-tree

![image.png](/assets/img/chapter2/database/dababase_2_1.png)

- 하나의 블럭은 `노드`라고 한다
- 상단을 `루트` 노드, 중간 노드를 `브랜치` 노드, 마지막 노드들을 `리프` 노드라고 한다
- `B-tree`는 노드 삽입 및 삭제 시 특정 규칙에 맞게 재정렬되어 왼쪽과 오른쪽의 자식 양쪽 수의 균형(Balance)을 유지해 `O(logN)`의 시간복잡도를 보장한다
- 하지만 `삽입/삭제`로 인해 트리가 재정렬되는 작업이 발생한다

![image.png](/assets/img/chapter2/database/dababase_2_2.png)

### B+tree

- 실제 데이터베이스 인덱스로 많이 사용되는 `B+tree`는 `B-tree`와 비슷한 구조이다
- 마지막 리프들은 `Linked List`으로 서로를 연결한다
- 또한 브랜치 노드들의 `key`와 `data`를 담을 수 있던 B-tree와는 다르게 **오직 리프 노드**에만 `key`와 `data`를 담는다
- 리프 노드를 제외하면 `data`를 담지 않아 메모리 용량에 대한 확보가 가능하다
- `B+tree`의 경우 **리프 노드가 서로 연결**되어 있어 **범위 검색 작업에 효율적이다**

![image.png](/assets/img/chapter2/database/dababase_2_3.png)

위에서 설명한 내용과 같이 인덱스의 구조인 B tree 계열의 경우 시간복잡도가 `O(logN)이다`

그러나 트리구조의 최악의 상황(한쪽 방향으로 쏠린경우)을 보완하기 위해 스스로 균형을 맞추는 바이너리 트리(`BST`)가 등장하며 대표적으로 AVL tree 와 Red-Black tree가 있다

### 테이블 스캔 종류

- **Table Full Scan:** 테이블에 속한 블록 전체를 읽어서 사용자가 원하는 데이터를 찾는다
- **Index Range Scan**
    - 인덱스 컬럼이 가공되지 않는 상태로 조건절에 있을 때 수행
    - 인덱스의 일정량을 스캔하면서 얻은 ROWID를 사용해 테이블 레코드를 찾는다
        - `ROWID`: 데이터의 주소
- **Index Full Scan**
    - 인덱스 컬럼이 조건에 없으면 Index Range Scan이 불가능하므로, 옵티마이저는 Table Full Scan을 고려한다
    - 대용량 테이블이라면 부담이 커 인덱스를 활용할 필요가 있다
    - 인덱스의 전체 크기는 데이블의 전체 크기보다 훨씬 적으므로 Index Range Scan을 할 수 없을 때 Full Table Scan 보다는 Index Full Scan을 고려한다
- **Index unique scan**
    - Primary key나 Unique index로 테이블에 접근하는 방식으로, 인덱스를 사용하는 스캔 방식 중 가장 효율적인 스캔 방법이다.
    - `WHERE`절에 `=` 조건으로 작성하며, 해당 조인 열이 `PK` 또는 `유니크 인덱스`의 선두 열로 설정 되었을 때 활용한다