# 아키텍처 개요 - 2
## 도메인 영역의 주요 구성 요소

도메인 영역의 모델은 도메인의 주요 개념을 표현하며 핵심 로직을 구현한다

| 엔티티 | 고유의 식별자를 갖는 객체로 자신의 **라이프 사이클을 갖는다**. 도메인 모델의 데이터를 포함하며 해당 데이터와 관련된 기능을 함께 제공한다 |
| --- | --- |
| 밸류 | 고유의 식별자를 갖지 않는 객체로 주로 개념적으로 하나인 값을 표현할 때 사용된다. 배송지 주소를 표현하기 위한 `주소`나 `금액` 같은 타입이 밸류 타입이다. 엔티티의 속성으로 사용할 뿐만 아니라 다른 밸류 타입의 속성으로도 사용할 수 있다 |
| 애그리거트 | 연관된 엔티티와 밸류 객체를 개념적으로 하나로 묶은 것이다 |
| 리포지토리 | 도메인 모델의 영속성을 처리한다 |
| 도메인 서비스 | 특정 엔티티에 속하지 않은 도메인 로직을 제공한다 |

### 엔티티와 밸류

이 두 모델의 큰 차이점은 도메인 모델의 엔티티는 **데이터와 함께 도메인 기능을 함께 제공한다**

- 주문은 표현하는 엔티티는 주문과 관련된 데이터뿐만 아니라 배송지 주소 변경을 위한 기능을 함께 제공한다

도메인 모델의 엔티티는 데이터와 함께 기능을 제공하는 객체이다. 도메인 관점에서 기능을 구현하고 기능 구현을 `캡슐화`해서 **데이터가 임의로 변경되는 것을 막는다**

또 다른 차이점으로 두 개 이상의 데이터가 개념적으로 하나인 경우 밸류 타입을 이용해서 표현할 수 있다

밸류는 불변으로 구현할 것을 권장하며, 이는 엔티티의 밸류 타입 데이터를 변경할 때는 객체 자체를 완전히 교체한다는 것을 의미한다

## 애그리거트

도메인이 커질수록 개발할 도메인 모델도 커지면서 많은 `엔티티`와 `밸류`가 출현한다. 엔티티와 밸류 개수가 많아질수록 모델은 점점 더 복잡해진다

- 도메인 모델이 복잡해지면 개발자가 전체 구조가 아닌 한 개 엔티티와 밸류에만 집중하는 상황이 발생한다
- 큰 수준에서 모델을 이해하지 못해 큰 틀에서 모델을 관리할 수 없는 상황에 빠질 수 있다
- 도메인 모델에서 전체 구조를 이해하는 데 도움이 되는 것이 바로 `애그리거트`이다

![image.png](/assets/img/chapter2/ddd/ddd_2_8.png)

- 애그리거트는 관련 객체를 하나로 묶은 군집이다
    - 애그리거트의 대표적인 예가 주문이다
    - 주문이라는 도메인은 `주문`, `배송지 정보`, `주문자`, `주문 목록`, `총 결제금액`의 하위 모델로 구성된다
    - 하위 개념을 표현한 모델을 하나로 묶어서 `주문`이라는 상위 개념으로 표현할 수 있다

애그리거트는 군집에 속한 객체를 관리하는 `루트 엔티티`를 갖는다. `루트 엔티티`는 애그리거트에 속해 있는 엔티티와 밸류 객체를 이용해서 애그리거트가 구현해야 할 기능을 제공한다

- 애그리거트를 사용하는 코드는 애그리거트 루트가 제공하는 기능을 실행하고 **애그리거트 루트를 통해서 간접적으로 애그리거트 내의 다른 엔티티나 밸류 객체에 접근**한다
- 애그리거트의 내부 구현을 숨겨서 애그리거트 단위로 구현을 `캡슐화` 할 수 있다

![image.png](/assets/img/chapter2/ddd/ddd_2_9.png)

### 리포지토리

- 도메인 객체를 지속적으로 사용하려면 `RDBMS`, `NoSQL`, `로컬 파일`과 같은 물리적인 저장소에 도메인 객체를 보관해야 하는데 이를 위한 도메인 모델이 `리포지토리`이다
- **리포지토리는 구현을 위한 도메인 모델이다**
- 리포지토리는 애그리거트 단위로 도메인 객체를 저장하고 조회하는 기능을 정의한다
- 도메인 모델을 사용해야 하는 코드는 `리포지토리`를 통해서 **도메인 객체를 구한 뒤에** **도메인 객체의 기능을 실행한다**

```java
public class CancelOrderService {
	private OrderRepository orderRepository;
	
	...
}
```

- 도메인 모델 관점에서 `OrderRepository`는 도메인 객체를 영속화하는 데 필요한 기능을 추상화 것으로 **고소준 모델에 속한다**
- 기반 기술을 이용해서 OrderRepository를 구현한 클래스는 **저수준 모듈**로 `인프라스트럭처` 영역에 속한다

![image.png](/assets/img/chapter2/ddd/ddd_2_10.png)

## 모듈 구성

![image.png](/assets/img/chapter2/ddd/ddd_2_11.png)

- 영역별로 모듈이 위치할 패키지를 구성할 수 있다

도메인이 크다면 하위 도메인을 나누고 각 하위 도메인마다 별도 패키지를 구성한다

![image.png](/assets/img/chapter2/ddd/ddd_2_12.png)

- 도메인 모듈은 도메인에 속한 `애그리거트`를 기준으로 다시 패키지를 구성한다
- 예를 들어 catalog 하위 도메인이 상품 애그리거트와 카테고리 애그리거트로 구성될 경우 도메인을 두 개의 하위 패키지로 구성할 수 있다

![image.png](/assets/img/chapter2/ddd/ddd_2_13.png)